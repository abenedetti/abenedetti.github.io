<!DOCTYPE HTML>
<!--
	Standout by Pixelarity
	pixelarity.com | hello@pixelarity.com
	License: pixelarity.com/license
-->
<html>
	<head>
		<title>Setting up RStudio & Shiny server</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
	</head>
	
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-52549735-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-52549735-1');
	</script>
	<script>
		var today = new Date();
		var yyyy = today.getFullYear();
	</script>
	
	<!-- Add favicon -->
	<link rel="icon" href="../images/favico.png">
	
	<body class="is-preload">

		<!-- Page wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<span class="logo"><a href="../index.html">Alessio <span>Benedetti</span></a></span>
						<a href="../portfolio.html"><span style = "font-size: small;">Back to My Works</span></a>
					</header>

				<!-- Nav -->
					<!--
					<nav id="menu">
						<div class="inner">
							<h2>Menu</h2>
							<ul class="links">
								<li><a href="index.html">Home</a></li>
								<li><a href="shiny.html">Shiny Apps</a></li>
								<li><a href="rmarkdown.html">R Markdown</a></li>
								<li><a href="elements.html">Elements</a></li>
							</ul>
							<a class="close"><span>Close</span></a>
						</div>
					</nav>
					-->					

				<!-- Main -->
					<section id="main" class="wrapper style2">
						<div class="inner">
							<header class="major special">
								<h1>Setting up RStudio & Shiny server</h1>
								<p>9th of july 2017 <code>vps</code><code>shiny server</code></p>
							</header>
							<a href="#" class="image main"><img src="../images/slides/servers.jpg" alt="" /></a>
							
							<header>
								<h2>My initial needs</h2>								
							</header>														
							<p>Last year I made a simple app called <a href="https://abenedetti.shinyapps.io/uCountVisualizer/" target="_blank">uCountVisualizer</a> which I published in the <a href="https://www.shinyapps.io/" target="_blank">shinyapps.io</a> platform. Unfortunately the free tier offered only 25 hours a month for all the apps hosted in it. When I started to work on my second app <a href="http://thelab.alessiobenedetti.com/shiny/uGeoTagger/" target="_blank">uGeoTagger</a> it became clear that this tier was insufficient. So was the next one which do not gave enoughs hours/month to host an app 24/7.</p>
							
							<header>
								<h2>Dean’s guide</h2>
							</header>														
							<p>For that reason I googled a little bit and found <a href="http://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean/" target="_blank">Dean’s article</a> which provided guidance to install the free version of shiny server. Dean is a shiny expert and by following his guide you’ll be able to:
								<ul>
									<li>set up your <a href="https://en.wikipedia.org/wiki/Virtual_private_server" target="_blank">virtual private server</a></li>
									<li>install <a href="https://cran.r-project.org/" target="_blank">R</a> and <a href="https://www.rstudio.com/products/rstudio/download-server/" target="_blank">R Studio server</a></li>
									<li>install your <a href="https://www.rstudio.com/products/shiny/shiny-server/" target="_blank">Shiny server</a></li>
								</ul>								
							</p>
							
							<header>
								<h2>Setting up the custom domain</h2>
							</header>														
							<p>As described in Dean’s article you may set a custom domain for your shiny server. However in my case, my domain (alessiobenedetti.com) was already used to host this blog in the github platform, therefore I needed to set up subdomains to bind the shiny server (thelab.alessiobenedetti.com).</p>
							<dl>
								<dt><a href="https://help.github.com/articles/using-a-custom-domain-with-github-pages/" target="_blank">using a custom domain with GitHub Pages</a></dt>
								<dt>setting up subdomains</dt>
								<dd>
									<ul>
										<li>first, in your registrar, you should add a new NS Record with the host portion of the subdomain, in my case I added the string “thelab” since my subdomain is “thelab.alessiobenedetti.com”. You should also add the DNS of your host, in my case I put “<a href="https://www.digitalocean.com/" target="_blank">ns1.digitalocean.com</a>”</li>
										<li>
										then you’d have to configure a new subdomain (I work with digital ocean and therefore I’ve made my setup in the “networking” section, as shown in the picture below)
										<br><br>
										<a href="#" class="image main"><img style = "max-width: 40%;" src="imgs/do_networking.png" alt="" /></a>
										</li>
										<li>after that you need to add the subdomain to your vps, by configuring the subdomain files in the following paths <code>/etc/nginx/sites-available/</code> and <code>/etc/nginx/sites-enabled/</code></li>
										<br>
										<ol>
											<li>inside the <code>sites-available</code> I created a file named <code>thelab</code> where I specified the path through the index file and the subdomain, as shown in the image below</li>
											<br>
											<a href="#" class="image main"><img style = "max-width: 40%;" src="imgs/nginx_config.png" alt="" /></a>
											<li>then in order to enable the configuration made in the previous step, inside the <code>sites-enabled</code> I created a symbolic link named <code>thelab</code> that references the <code>thelab</code> file in the <code>sites-available</code> directory. This can be done with the following statement <code>ln -s /etc/nginx/sites-available/thelab /etc/nginx/sites-enabled/thelab</code>. For more details you can refer to the <a href="https://www.digitalocean.com/community/questions/how-to-create-subdomain-with-nginx-server-in-the-same-droplet" target="_blank">following guide</a> on digital ocean and <a href="https://askubuntu.com/questions/56339/how-to-create-a-soft-or-symbolic-link" target="_blank">this post</a> that I found useful to create symbolic links</li>
										</ol>
										<li>next, you need to configure your web server, in my case nginx, by adding a couple of new folders named <i>thelab</i> and <i>thelab/html</i> inside <code>/var/www</code>. In the resulting path <code>/var/www/thelab/html</code> you can add your index.html</li>
										<li>lastly you have to restart nginx with the <code>service nginx restart</code> statement, in order to make those changes effective</li>										
									</ul>
								</dd>
							</dl>
							
							<header>
								<h2>Installing mongoDB</h2>
							</header>														
							<p>When I started developing the app I used a google sheet page as persistent storage. Despite R offers nice packages to manage google’s docs, I wasn’t satisfied of the loading time. That’s why I moved to a DB and chose Mongo. For simplicity I initially connected the app to an online istance of Mongo at the <a href="https://mlab.com/" target="_blank">mlab.com</a> hosting site. Later on, since the free tier of mlab.com doesn’t allow backups/restore, unless you pay for them, I decided to install my own istance of mongoDB. This <a href="https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-16-04" target="_blank">guide</a> was useful in doing that.</p>
							
							<header>
								<h2>Installing RoboMongo</h2>
							</header>														
							<p>Browsing through mongoDB is made easier through a GUI browser. I found <a href="https://robomongo.org/" target="_blank">Robo 3T (formerly RoboMongo)</a>. Setting up the connection to the remote mongoDB was a little bit tricky because of the bad format of the private key. You need to create an Open SSH key (see <a href="https://github.com/Studio3T/robomongo/issues/484" target="_blank">this thread</a> for support)</p>
							
							<header>
								<h2>Setting up scheduled jobs to backups/restore the app DB</h2>
							</header>														
							<p>Last difficulty was automating the backup/restore jobs for the database. My wish was to create one daily backup, while keeping the last 5 backups day by day. I’ve had to dig on:
							<ol>
								<li>changing the directory of the statements in an ubuntu distro</li>
								<li>setting up crontab job</li>
							</ol>
							</p>
							<p>Point 1) came from the fact that “shell scripts are run inside a subshell, and each subshell has its own concept of what the current directory is.” (<a href="https://stackoverflow.com/questions/255414/why-doesnt-cd-work-in-a-bash-shell-script" target="_blank">stack overflow reference</a>). Initially I was working with aliases but then I wasn’t able to set the crontab job. At the end I simply created a function in a sh script that was easier to schedule on crontab.</p>
							<p>End of this journey! I’ve made a quick recap of the main points, hope that you can eventually find some useful hints!</p>
							
						</div>
					</section>

				<!-- Footer -->
					<section id="footer" class="wrapper">
						<div class="inner">
							<div class="split">
								<div class="content">
									<header>
										<h2>About</h2>
									</header>
									<p>Learner, I'm a definitive fan of continuous learning, and MOOCS are my home!</p>
									<!--
									<ul class="actions">
										<li><a href="#" class="button next">Get In Touch</a></li>
									</ul>
									-->
								</div>
								<ul class="contact-icons">
									<li><a href="https://twitter.com/_alessioB_" target="_blank" class="icon brands alt fa-twitter"><span class="label">twitter.com</span></a></li>
									<li><a href="https://github.com/abenedetti/" target="_blank" class="icon brands alt fa-github"><span class="label">github.com</span></a></li>
									<li><a href="https://stackoverflow.com/users/7916509/alessio?tab=profile" target="_blank" class="icon brands alt fa-stack-overflow"><span class="label">stackoverflow.com</span></a></li>
									<li><a href="https://www.kaggle.com/alessi0" target="_blank" class="icon brands alt fa-kaggle"><span class="label">kaggle.com</span></a></li>
								</ul>
							</div>
						</div>
					</section>

				<!-- Copyright -->
					<section class="wrapper style2 copyright">
						<div class="inner">
							&copy; alessiobenedetti.com - <script>document.write(yyyy);</script> - all rights reserved
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>